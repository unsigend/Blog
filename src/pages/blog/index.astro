---
import { getCollection } from 'astro:content'
import BlogCard from '../../components/BlogCard.astro'
import BaseLayout from '../../layouts/BaseLayout.astro'

const allPosts = await getCollection('blog')

// Group posts by category
const postsByCategory = {
	'algorithm': allPosts.filter(post => post.data.category === 'algorithm').sort(
		(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
	),
	'low-level-system': allPosts.filter(post => post.data.category === 'low-level-system').sort(
		(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
	),
	'software-design': allPosts.filter(post => post.data.category === 'software-design').sort(
		(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
	),
}

const categoryNames = {
	'algorithm': 'Algorithm',
	'low-level-system': 'Low Level System',
	'software-design': 'Software Design'
}
---

<BaseLayout>
	<main class="app-container pt-36">
		<h1 class="text-6xl pb-8 font-bold">Blog</h1>
		<p class="md:w-2/3 text-lg leading-[2rem]">
			Welcome to my blog! Here you'll find a collection of my thoughts and
			experiences. I hope you enjoy reading them as much as I enjoy writing
			them.
		</p>
	</main>

	{
		Object.entries(postsByCategory).map(([categoryKey, posts]) => {
			if (posts.length === 0) {
				return null
			}
			const category = categoryKey as keyof typeof categoryNames
			
			return (
				<section class="app-container py-12">
					<h2 class="text-4xl font-bold mb-8 pb-4 border-b border-gray-200 dark:border-gray-700">
						{categoryNames[category]}
					</h2>
					<ul class="posts-grid-container">
						{
							posts.map((post) => (
								<li>
									<BlogCard post={post} />
								</li>
							))
						}
					</ul>
				</section>
			)
		})
	}
</BaseLayout>
