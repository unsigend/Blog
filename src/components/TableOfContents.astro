---
import type { MarkdownHeading } from 'astro'

interface Props {
	headings: MarkdownHeading[]
}

const { headings } = Astro.props

// Group headings: h2 as top-level, h3 as nested under previous h2
interface TOCHeading extends MarkdownHeading {
	children: MarkdownHeading[]
}
const toc: TOCHeading[] = []
let lastH2: TOCHeading | null = null
for (const heading of headings) {
	if (heading.depth === 2) {
		lastH2 = { ...heading, children: [] }
		toc.push(lastH2)
	} else if (heading.depth === 3 && lastH2) {
		lastH2.children.push(heading)
	}
}
---

{
	toc.length > 0 ? (
		<nav class="py-12 rounded">
			<h2 class="text-2xl mr-2 pb-1 mb-3 font-bold">On This Page</h2>
			<ul class="space-y-3">
				{toc.map((h2) => (
					<li>
						<a class="hover:underline underline-offset-4" href={`#${h2.slug}`}>
							{h2.text}
						</a>
						{h2.children.length > 0 && (
							<ul class="ml-4 mt-2 space-y-2 border-l border-gray-300 dark:border-gray-700 pl-4">
								{h2.children.map((h3) => (
									<li>
										<a
											class="hover:underline underline-offset-4 text-sm opacity-80"
											href={`#${h3.slug}`}
										>
											{h3.text}
										</a>
									</li>
								))}
							</ul>
						)}
					</li>
				))}
			</ul>
		</nav>
	) : (
		<div />
	)
}
