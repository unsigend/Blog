---
import type { CollectionEntry } from 'astro:content'
import FormattedDate from '../components/FormattedDate.astro'
import type { MarkdownHeading } from 'astro'
import TableOfContents from '../components/TableOfContents.astro'
import dayjs from 'dayjs'

type Props = CollectionEntry<'blog'>['data'] & {
	headings: MarkdownHeading[]
	slug: string
	remarkPluginFrontmatter: Record<string, string>
}

const {
	title,
	description,
	pubDate,
	updatedDate,
	coverImageCredit,
	coverImage,
	headings,
	slug,
	remarkPluginFrontmatter,
} = Astro.props

import BaseLayout from './BaseLayout.astro'
import { Icon } from 'astro-icon/components'

// Cover image path - slug already includes category folder, so use it directly
// slug format: "category/post-name" or just "post-name"
const coverImagePath = `/blogimages/${slug}/${coverImage || 'cover.png'}`

const lastModified = remarkPluginFrontmatter.lastModified 
	? dayjs(remarkPluginFrontmatter.lastModified).format('D MMM YYYY')
	: dayjs(updatedDate || pubDate).format('D MMM YYYY')
---

<BaseLayout title={title} description={description}>
	<main>
		<article>
			<div class="app-container py-24">
				<div class="max-w-7xl mx-auto">
					<div class="flex flex-col lg:flex-row gap-12">
						<!-- Main content - centered -->
						<div class="flex-1 max-w-4xl mx-auto lg:mx-0 lg:pr-8">
					<div class="space-y-6">
						<!-- Title -->
						<h1 class="text-4xl sm:text-5xl lg:text-6xl leading-tight font-bold tracking-tight">
							{title}
						</h1>
						
					<!-- Metadata -->
					<div class="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-6 text-sm text-gray-600 dark:text-gray-400 border-b border-gray-200 dark:border-gray-700 pb-8">
						<span class="font-medium">
							<FormattedDate date={pubDate} />
						</span>
						<span class="text-md opacity-70">
							Updated: {lastModified}
						</span>
					</div>

					<img
						src={coverImagePath}
						alt={title}
						class="rounded-lg w-full max-w-2xl mx-auto"
						loading="lazy"
					/>
					{coverImageCredit && (
						<p class="mt-2 mb-8 opacity-80 italic text-sm">
							Image Credit: {coverImageCredit}
						</p>
					)}
					</div>
					<div
						class="prose prose-neutral prose-lg md:prose-xl dark:prose-invert prose-img:rounded-xl prose-figure:text-center prose-img:mx-auto"
					>
						<slot />
					</div>

					<!-- Suggest edit -->
					<div class="flex justify-between mt-16 gap-4 flex-wrap italic">
						<a
							href={`https://github.com/yashjawale/yashjawale.github.io/edit/main/src/content/blog/${slug}.md`}
							target="_blank"
							rel="noopener noreferrer"
							class="hover:underline underline-offset-4 opacity-70 hover:opacity-100"
							><Icon name="mdi:pencil-outline" class="inline-block" />
							Suggest an edit
						</a>
						<p class="opacity-70">
							Last modified: {lastModified}
						</p>
					</div>
						</div>
						
						<!-- Table of contents - right side -->
						<div class="lg:w-80 lg:flex-shrink-0">
							<div class="sticky top-28 hidden lg:block">
								<TableOfContents headings={headings} />
							</div>
						</div>
					</div>
				</div>
			</div>
		</article>
	</main>
</BaseLayout>
